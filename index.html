<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeTyper - Programming Typing Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Import Hubot Sans for common UI elements */
        @import url('https://fonts.googleapis.com/css2?family=Hubot+Sans:wght@300;400;500;600;700&display=swap');

        /* JetBrains Mono is already referenced in the original for code */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap');

        :root {
            --primary: #1e1e2e;
            --secondary: #181825;
            --text: #cdd6f4;
            --text-dim: #a6adc8;
            --accent: #afeef9;
            --accent-hover: #64e2f8;
            --error: #f38ba8;
            --correct: #a6e3a1;
            --button-bg: #313244;
            --button-hover: #45475a;
            --font-ui: 'Hubot sans', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
            --border-radius: 8px;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--primary);
            color: var(--text);
            font-family: var(--font-ui);
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 70px;
            position: relative;
        }

        .logo {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 1.1rem;
            font-weight: 300;
            max-width: 500px;
            margin: 0 auto;
        }

        .settings-panel {
            background-color: var(--secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .settings {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .setting-group {
            position: relative;
        }

        .setting-label {
            font-size: 0.8rem;
            color: var(--text-dim);
            margin-bottom: 5px;
            display: block;
        }

        select,
        button {
            background-color: var(--button-bg);
            color: var(--text);
            border: none;
            padding: 10px 18px;
            font-family: var(--font-ui);
            font-size: 0.95rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        select {
            appearance: none;
            padding-right: 30px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23cdd6f4' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        select:hover,
        button:hover {
            background-color: var(--button-hover);
        }

        select:focus,
        button:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        button#startBtn {
            background-color: var(--accent);
            color: var(--secondary);
            font-weight: 600;
            padding: 5px 12px;
        }

        button#startBtn:hover {
            background-color: var(--accent-hover);
        }

        .typing-container {
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            background-color: var(--secondary);
            padding: 30px;
            border-radius: var(--border-radius);
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .typing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--button-bg);
        }

        .typing-title {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--accent);
        }

        .timer {
            font-family: var(--font-code);
            font-size: 1.2rem;
            color: var(--text);
        }

        .typing-content {
            font-family: var(--font-code);
            font-size: 1.2rem;
            margin-bottom: 20px;
            white-space: pre-wrap;
            user-select: none;
            line-height: 1.6;
            overflow-x: auto;
        }

        .typing-input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .code-content {
            margin-left: 40px;
            overflow-x: auto;
        }

        .code-char {
            position: relative;
            margin: 0;
            padding: 0;
        }

        .active-char {
            position: relative;
        }

        .active-char::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 2px;
            background-color: var(--accent);
            animation: blink 1s infinite;
        }

        .correct-char {
            color: var(--correct);
        }

        .error-char {
            color: var(--error);
            text-decoration: underline;
        }

        #result {
            margin-top: 40px;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #result h2 {
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 1.8rem;
            font-weight: 600;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 25px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: var(--secondary);
            border-radius: var(--border-radius);
            min-width: 150px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--accent);
            font-family: var(--font-code);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-top: 5px;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 30px 0;
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .restart-btn {
            background-color: var(--accent);
            color: var(--secondary);
            font-weight: 600;
            margin-top: 30px;
            padding: 12px 30px;
            font-size: 1rem;
        }

        .restart-btn:hover {
            background-color: var(--accent-hover);
        }

        .theme-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: var(--button-bg);
            transition: var(--transition);
        }

        .theme-btn:hover {
            background-color: var(--button-hover);
        }

        @keyframes blink {
            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Syntax highlighting */
        .keyword {
            color: #f38ba8;
        }

        .function {
            color: #94e2d5;
        }

        .string {
            color: #f9e2af;
        }

        .number {
            color: #fab387;
        }

        .comment {
            color: #a6adc8;
        }

        .operator {
            color: #f38ba8;
        }

        .brackets {
            color: #cdd6f4;
        }

        /* Light theme */
        .light-theme {
            --primary: #f8f8fa;
            --secondary: #eeeef0;
            --text: #2c2e31;
            --text-dim: #68686e;
            --accent: #4124e7;
            --accent-hover: #4828d9;
            --error: #ef4444;
            --correct: #22c55e;
            --button-bg: #dfdfe3;
            --button-hover: #d1d1d6;
        }

        .light-theme .keyword {
            color: #7c3aed;
        }

        .light-theme .function {
            color: #0891b2;
        }

        .light-theme .string {
            color: #ca8a04;
        }

        .light-theme .number {
            color: #c2410c;
        }

        .light-theme .comment {
            color: #68686e;
        }

        .light-theme .operator {
            color: #7c3aed;
        }

        .light-theme .brackets {
            color: #2c2e31;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            header {
                padding-top: 50px;
            }

            .logo {
                font-size: 2.5rem;
            }

            .settings {
                flex-direction: column;
                align-items: stretch;
            }

            .typing-container {
                padding: 20px;
            }

            .typing-content {
                font-size: 1rem;
            }

            .stats {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }

            .stat-item {
                width: 100%;
                max-width: 250px;
            }
        }

        .streak-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: var(--accent);
            animation: streak-animation 1s ease-out;
            pointer-events: none;
        }

        @keyframes streak-animation {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
    </style>
</head>

<body>
    <div class="container">
        <button class="theme-btn" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>

        <header>
            <div class="logo">CodeTyper</div>
            <div class="subtitle">Improve your coding speed and accuracy with language-specific typing tests.</div>
        </header>

        <div class="settings-panel">
            <div class="settings">
                <div class="setting-group">
                    <label class="setting-label">Language</label>
                    <select id="languageSelect">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="csharp">C#</option>
                        <option value="cpp">C++</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label class="setting-label">Difficulty</label>
                    <select id="difficultySelect">
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label class="setting-label">Time</label>
                    <select id="timeSelect">
                        <option value="30">30 seconds</option>
                        <option value="60" selected>60 seconds</option>
                        <option value="120">2 minutes</option>
                        <option value="300">5 minutes</option>
                    </select>
                </div>

                <button id="startBtn">Start Test</button>
            </div>
        </div>

        <div class="typing-container">
            <div class="typing-header">
                <div class="typing-title">Start typing when ready...</div>
                <div class="timer">01:00</div>
            </div>
            <div class="code-content">
                <div class="typing-content" id="typingContent"></div>
            </div>
            <input type="text" class="typing-input" id="typingInput" autofocus>
        </div>

        <div id="result">
            <h2>Test Results</h2>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="wpmValue">0</div>
                    <div class="stat-label">WPM</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracyValue">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="charactersValue">0</div>
                    <div class="stat-label">Characters</div>
                </div>
            </div>
            <button class="restart-btn" id="restartBtn">Try Again</button>
        </div>
    </div>

    <footer>
        <p>CodeTyper - Improve your programming typing skills</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // DOM elements
            const typingContent = document.getElementById('typingContent');
            const typingInput = document.getElementById('typingInput');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
            const timer = document.querySelector('.timer');
            const result = document.getElementById('result');
            const wpmValue = document.getElementById('wpmValue');
            const accuracyValue = document.getElementById('accuracyValue');
            const charactersValue = document.getElementById('charactersValue');
            const typingTitle = document.querySelector('.typing-title');
            const themeToggle = document.getElementById('themeToggle');
            const languageSelect = document.getElementById('languageSelect');
            const difficultySelect = document.getElementById('difficultySelect');
            const timeSelect = document.getElementById('timeSelect');

            // Enhanced variables
            let currentIndex = 0;
            let errors = 0;
            let timerInterval;
            let timeLeft;
            let started = false;
            let totalTyped = 0;
            let correctTyped = 0;
            let isPaused = false;
            let lastActiveTime = Date.now();
            let streakCount = 0;
            let maxStreak = 0;

            // Code snippets for different languages and difficulties
            const codeSnippets = {
                javascript: {
                    easy: [
                        'function greet(name) {\n  return "Hello, " + name + "!";\n}',
                        'const sum = (a, b) => {\n  return a + b;\n}',
                        'let counter = 0;\nfunction increment() {\n  counter++;\n  return counter;\n}'
                    ],
                    medium: [
                        'function fibonacci(n) {\n  if (n <= 1) return n;\n  return fibonacci(n - 1) + fibonacci(n - 2);\n}',
                        'const filterEven = (numbers) => {\n  return numbers.filter(num => num % 2 === 0);\n}',
                        'function createCounter() {\n  let count = 0;\n  return {\n    increment() { count++; },\n    decrement() { count--; },\n    getCount() { return count; }\n  };\n}'
                    ],
                    hard: [
                        'async function fetchData(url) {\n  try {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error("Network response was not ok");\n    }\n    return await response.json();\n  } catch (error) {\n    console.error("Fetch error:", error);\n    return null;\n  }\n}'
                    ]
                },
                python: {
                    easy: [
                        'def greet(name):\n    return f"Hello, {name}!"',
                        'def calculate_sum(a, b):\n    return a + b',
                        'def is_even(number):\n    return number % 2 == 0'
                    ],
                    medium: [
                        'def fibonacci(n):\n    if n <= 1:\n        return n\n    return fibonacci(n - 1) + fibonacci(n - 2)',
                        'def bubble_sort(arr):\n    n = len(arr)\n    for i in range(n):\n        for j in range(0, n - i - 1):\n            if arr[j] > arr[j + 1]:\n                arr[j], arr[j + 1] = arr[j + 1], arr[j]\n    return arr',
                        'def find_primes(n):\n    primes = []\n    for num in range(2, n + 1):\n        if all(num % i != 0 for i in range(2, int(num ** 0.5) + 1)):\n            primes.append(num)\n    return primes'
                    ],
                    hard: [
                        'from typing import List, Optional\n\nclass TreeNode:\n    def __init__(self, val=0):\n        self.val = val\n        self.left = None\n        self.right = None\n\ndef level_order_traversal(root: Optional[TreeNode]) -> List[List[int]]:\n    if not root:\n        return []\n    result = []\n    queue = [root]\n    while queue:\n        level = []\n        for _ in range(len(queue)):\n            node = queue.pop(0)\n            level.append(node.val)\n            if node.left:\n                queue.append(node.left)\n            if node.right:\n                queue.append(node.right)\n        result.append(level)\n    return result'
                    ]
                },
                java: {
                    easy: [
                        'public class Calculator {\n    public int add(int a, int b) {\n        return a + b;\n    }\n}',
                        'public String reverseString(String str) {\n    return new StringBuilder(str).reverse().toString();\n}',
                        'public boolean isPalindrome(String str) {\n    str = str.toLowerCase();\n    int left = 0, right = str.length() - 1;\n    while (left < right) {\n        if (str.charAt(left) != str.charAt(right)) return false;\n        left++;\n        right--;\n    }\n    return true;\n}'
                    ],
                    medium: [
                        'public class Stack<T> {\n    private ArrayList<T> items = new ArrayList<>();\n    \n    public void push(T item) {\n        items.add(item);\n    }\n    \n    public T pop() {\n        if (isEmpty()) throw new EmptyStackException();\n        return items.remove(items.size() - 1);\n    }\n    \n    public boolean isEmpty() {\n        return items.isEmpty();\n    }\n}',
                        'public int binarySearch(int[] arr, int target) {\n    int left = 0, right = arr.length - 1;\n    while (left <= right) {\n        int mid = left + (right - left) / 2;\n        if (arr[mid] == target) return mid;\n        if (arr[mid] < target) left = mid + 1;\n        else right = mid - 1;\n    }\n    return -1;\n}'
                    ],
                    hard: [
                        'public class Graph {\n    private Map<Integer, List<Integer>> adj = new HashMap<>();\n    \n    public void addEdge(int src, int dest) {\n        adj.computeIfAbsent(src, k -> new ArrayList<>()).add(dest);\n        adj.computeIfAbsent(dest, k -> new ArrayList<>()).add(src);\n    }\n    \n    public List<Integer> shortestPath(int start, int end) {\n        Queue<Integer> queue = new LinkedList<>();\n        Map<Integer, Integer> parent = new HashMap<>();\n        queue.offer(start);\n        parent.put(start, null);\n        \n        while (!queue.isEmpty()) {\n            int current = queue.poll();\n            if (current == end) break;\n            \n            for (int neighbor : adj.getOrDefault(current, Collections.emptyList())) {\n                if (!parent.containsKey(neighbor)) {\n                    queue.offer(neighbor);\n                    parent.put(neighbor, current);\n                }\n            }\n        }\n        \n        List<Integer> path = new ArrayList<>();\n        Integer current = end;\n        while (current != null) {\n            path.add(0, current);\n            current = parent.get(current);\n        }\n        return path;\n    }\n}'
                    ]
                },
                csharp: {
                    easy: [
                        'public class Person {\n    public string Name { get; set; }\n    public int Age { get; set; }\n    \n    public Person(string name, int age) {\n        Name = name;\n        Age = age;\n    }\n}',
                        'public static List<int> GetEvenNumbers(List<int> numbers) {\n    return numbers.Where(n => n % 2 == 0).ToList();\n}',
                        'public static string FormatName(string firstName, string lastName) {\n    return $"{lastName}, {firstName}";\n}'
                    ],
                    medium: [
                        'public class LinkedList<T> {\n    private class Node {\n        public T Value;\n        public Node Next;\n        \n        public Node(T value) {\n            Value = value;\n            Next = null;\n        }\n    }\n    \n    private Node head;\n    \n    public void Add(T value) {\n        if (head == null) {\n            head = new Node(value);\n            return;\n        }\n        \n        Node current = head;\n        while (current.Next != null) {\n            current = current.Next;\n        }\n        current.Next = new Node(value);\n    }\n}'
                    ],
                    hard: [
                        'public class AsyncCache<TKey, TValue> {\n    private readonly ConcurrentDictionary<TKey, Task<TValue>> cache;\n    private readonly Func<TKey, Task<TValue>> valueFactory;\n    \n    public AsyncCache(Func<TKey, Task<TValue>> valueFactory) {\n        this.cache = new ConcurrentDictionary<TKey, Task<TValue>>();\n        this.valueFactory = valueFactory;\n    }\n    \n    public async Task<TValue> GetOrAddAsync(TKey key) {\n        return await cache.GetOrAdd(key, k => valueFactory(k));\n    }\n    \n    public void Remove(TKey key) {\n        cache.TryRemove(key, out _);\n    }\n}'
                    ]
                },
                cpp: {
                    easy: [
                        '#include <vector>\n\nstd::vector<int> range(int start, int end) {\n    std::vector<int> result;\n    for (int i = start; i < end; i++) {\n        result.push_back(i);\n    }\n    return result;\n}',
                        'template<typename T>\nT max(T a, T b) {\n    return (a > b) ? a : b;\n}',
                        'bool isPrime(int n) {\n    if (n <= 1) return false;\n    for (int i = 2; i * i <= n; i++) {\n        if (n % i == 0) return false;\n    }\n    return true;\n}'
                    ],
                    medium: [
                        'template<typename T>\nclass SmartPointer {\n    T* ptr;\npublic:\n    SmartPointer(T* p = nullptr) : ptr(p) {}\n    ~SmartPointer() { delete ptr; }\n    T& operator*() { return *ptr; }\n    T* operator->() { return ptr; }\n};',
                        'void quickSort(int arr[], int left, int right) {\n    if (left >= right) return;\n    int pivot = arr[right];\n    int i = left - 1;\n    \n    for (int j = left; j < right; j++) {\n        if (arr[j] <= pivot) {\n            i++;\n            std::swap(arr[i], arr[j]);\n        }\n    }\n    std::swap(arr[i + 1], arr[right]);\n    \n    quickSort(arr, left, i);\n    quickSort(arr, i + 2, right);\n}'
                    ],
                    hard: [
                        'template<typename T>\nclass ThreadSafeQueue {\n    std::queue<T> queue;\n    mutable std::mutex mutex;\n    std::condition_variable cond;\n\npublic:\n    void push(T value) {\n        std::lock_guard<std::mutex> lock(mutex);\n        queue.push(std::move(value));\n        cond.notify_one();\n    }\n    \n    T pop() {\n        std::unique_lock<std::mutex> lock(mutex);\n        cond.wait(lock, [this] { return !queue.empty(); });\n        T value = std::move(queue.front());\n        queue.pop();\n        return value;\n    }\n};'
                    ]
                },
                html: {
                    easy: [
                        '<nav class="navbar">\n    <ul class="nav-list">\n        <li><a href="#home">Home</a></li>\n        <li><a href="#about">About</a></li>\n        <li><a href="#contact">Contact</a></li>\n    </ul>\n</nav>',
                        '<form class="contact-form">\n    <div class="form-group">\n        <label for="name">Name:</label>\n        <input type="text" id="name" required>\n    </div>\n    <button type="submit">Send</button>\n</form>',
                        '<div class="card">\n    <img src="image.jpg" alt="Card image">\n    <div class="card-content">\n        <h3>Card Title</h3>\n        <p>Card description goes here.</p>\n    </div>\n</div>'
                    ],
                    medium: [
                        '<header class="site-header">\n    <nav class="main-nav">\n        <div class="logo">\n            <img src="logo.png" alt="Site Logo">\n        </div>\n        <ul class="nav-links">\n            <li><a href="#home">Home</a></li>\n            <li><a href="#products">Products</a></li>\n            <li><a href="#about">About</a></li>\n            <li><a href="#contact">Contact</a></li>\n        </ul>\n        <button class="mobile-menu">\n            <span></span>\n            <span></span>\n            <span></span>\n        </button>\n    </nav>\n</header>'
                    ],
                    hard: [
                        '<form class="checkout-form">\n    <div class="form-section">\n        <h2>Shipping Information</h2>\n        <div class="form-group">\n            <label for="fullName">Full Name</label>\n            <input type="text" id="fullName" required>\n        </div>\n        <div class="form-group">\n            <label for="address">Address</label>\n            <input type="text" id="address" required>\n        </div>\n        <div class="form-row">\n            <div class="form-group">\n                <label for="city">City</label>\n                <input type="text" id="city" required>\n            </div>\n            <div class="form-group">\n                <label for="zipCode">ZIP Code</label>\n                <input type="text" id="zipCode" required>\n            </div>\n        </div>\n    </div>\n    <div class="form-section">\n        <h2>Payment Details</h2>\n        <div class="form-group">\n            <label for="cardNumber">Card Number</label>\n            <input type="text" id="cardNumber" required>\n        </div>\n        <div class="form-row">\n            <div class="form-group">\n                <label for="expiry">Expiry Date</label>\n                <input type="text" id="expiry" placeholder="MM/YY" required>\n            </div>\n            <div class="form-group">\n                <label for="cvv">CVV</label>\n                <input type="text" id="cvv" required>\n            </div>\n        </div>\n    </div>\n    <button type="submit" class="submit-btn">Complete Purchase</button>\n</form>'
                    ]
                },
                css: {
                    easy: [
                        '.button {\n    padding: 10px 20px;\n    background-color: #007bff;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n\n.button:hover {\n    background-color: #0056b3;\n}',
                        '.card {\n    width: 300px;\n    padding: 20px;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n}',
                        '.grid {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 20px;\n    padding: 20px;\n}'
                    ],
                    medium: [
                        '@media screen and (max-width: 768px) {\n    .container {\n        flex-direction: column;\n    }\n    \n    .sidebar {\n        width: 100%;\n        margin-bottom: 20px;\n    }\n    \n    .main-content {\n        width: 100%;\n    }\n}',
                        '.dropdown {\n    position: relative;\n    display: inline-block;\n}\n\n.dropdown-content {\n    display: none;\n    position: absolute;\n    background-color: white;\n    min-width: 160px;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n    z-index: 1;\n}\n\n.dropdown:hover .dropdown-content {\n    display: block;\n}'
                    ],
                    hard: [
                        '@keyframes slideIn {\n    0% {\n        transform: translateX(-100%);\n        opacity: 0;\n    }\n    100% {\n        transform: translateX(0);\n        opacity: 1;\n    }\n}\n\n.animate-slide {\n    animation: slideIn 0.5s ease-out;\n}\n\n@media (prefers-reduced-motion: reduce) {\n    .animate-slide {\n        animation: none;\n    }\n}',
                        '.theme-switch {\n    --switch-width: 60px;\n    --switch-height: 30px;\n    position: relative;\n    display: inline-block;\n    width: var(--switch-width);\n    height: var(--switch-height);\n}\n\n.theme-switch input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n}\n\n.slider {\n    position: absolute;\n    cursor: pointer;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    transition: .4s;\n    border-radius: var(--switch-height);\n}\n\n.slider:before {\n    position: absolute;\n    content: "";\n    height: calc(var(--switch-height) - 8px);\n    width: calc(var(--switch-height) - 8px);\n    left: 4px;\n    bottom: 4px;\n    background-color: white;\n    transition: .4s;\n    border-radius: 50%;\n}\n\ninput:checked + .slider {\n    background-color: #2196F3;\n}\n\ninput:checked + .slider:before {\n    transform: translateX(calc(var(--switch-width) - var(--switch-height)));\n}'
                    ]
                }
            };

            // Set up event listeners
            startBtn.addEventListener('click', startTest);
            restartBtn.addEventListener('click', resetTest);
            typingInput.addEventListener('input', handleTyping);
            themeToggle.addEventListener('click', toggleTheme);

            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + Enter to start/restart
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    if (!started) startTest();
                    else resetTest();
                }
                // Escape to pause
                if (e.key === 'Escape' && started) {
                    e.preventDefault();
                    togglePause();
                }
            });

            // Initialize the typing test
            function initializeTest() {
                const language = languageSelect.value;
                const difficulty = difficultySelect.value;
                const selectedCode = getRandomSnippet(language, difficulty);
                displayCode(selectedCode);
                updateTimer(parseInt(timeSelect.value));
            }

            // Get a random snippet from the code snippets
            function getRandomSnippet(language, difficulty) {
                const snippets = codeSnippets[language]?.[difficulty] || codeSnippets.javascript.easy;
                const randomIndex = Math.floor(Math.random() * snippets.length);
                return snippets[randomIndex];
            }

            // Display code with character spans
            function displayCode(code) {
                typingContent.innerHTML = '';
                for (const char of code) {
                    const span = document.createElement('span');
                    span.classList.add('code-char');
                    if (char === ' ') {
                        span.innerHTML = '&nbsp;';
                    } else if (char === '\n') {
                        span.innerHTML = '<br>';
                    } else {
                        span.textContent = char;
                    }
                    typingContent.appendChild(span);
                }
            }

            // Enhanced start test function
            function startTest() {
                if (started) return;

                resetTest();
                typingTitle.textContent = '3';
                startBtn.disabled = true;

                // Countdown animation
                let countdown = 3;
                const countdownInterval = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        typingTitle.textContent = countdown.toString();
                    } else {
                        clearInterval(countdownInterval);
                typingTitle.textContent = 'Go!';
                        startTypingTest();
                    }
                }, 1000);
            }

            // Separate function to start the actual test
            function startTypingTest() {
                timeLeft = parseInt(timeSelect.value);
                const firstChar = typingContent.querySelector('.code-char');
                if (firstChar) firstChar.classList.add('active-char');

                typingInput.focus();
                started = true;
                lastActiveTime = Date.now();

                timerInterval = setInterval(() => {
                    if (!isPaused) {
                    timeLeft--;
                    updateTimer(timeLeft);

                        // Check for inactivity (15 seconds)
                        if (Date.now() - lastActiveTime > 15000) {
                            endTest('Inactivity detected');
                        }

                    if (timeLeft <= 0) {
                            endTest('Time\'s up!');
                        }
                    }
                }, 1000);
            }

            // Enhanced typing handler with improved accuracy
            function handleTyping(e) {
                if (!started || isPaused) return;
                if (!started) {
                    startTest();
                    return;
                }

                lastActiveTime = Date.now();
                const inputValue = e.data;
                const codeChars = typingContent.querySelectorAll('.code-char');

                if (currentIndex < codeChars.length) {
                    const currentChar = codeChars[currentIndex];
                    const expectedChar = currentChar.textContent || ' ';

                    totalTyped++;

                    if (inputValue === expectedChar) {
                        currentChar.classList.remove('active-char');
                        currentChar.classList.add('correct-char');
                        correctTyped++;
                        streakCount++;
                        maxStreak = Math.max(maxStreak, streakCount);
                        
                        // Visual feedback for streaks
                        if (streakCount > 10) {
                            showStreakEffect(streakCount);
                        }
                    } else {
                        currentChar.classList.remove('active-char');
                        currentChar.classList.add('error-char');
                        errors++;
                        streakCount = 0;
                        
                        // Vibration feedback for errors if supported
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                    }

                    currentIndex++;

                    // Scroll into view if needed
                    if (currentIndex < codeChars.length) {
                        codeChars[currentIndex].classList.add('active-char');
                        ensureCharacterVisible(codeChars[currentIndex]);
                    } else {
                        endTest('Completed!');
                        return;
                    }

                    // Update live stats
                    updateLiveStats();
                }

                typingInput.value = '';
            }

            // New function to ensure the current character is visible
            function ensureCharacterVisible(element) {
                const container = document.querySelector('.code-content');
                const elementRect = element.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();

                if (elementRect.bottom > containerRect.bottom) {
                    container.scrollTop += elementRect.bottom - containerRect.bottom + 20;
                }
            }

            // New function to show streak effect
            function showStreakEffect(streak) {
                const effect = document.createElement('div');
                effect.className = 'streak-effect';
                effect.textContent = `${streak} STREAK!`;
                document.body.appendChild(effect);
                
                setTimeout(() => effect.remove(), 1000);
            }

            // New function to update live statistics
            function updateLiveStats() {
                const timeInMinutes = (parseInt(timeSelect.value) - timeLeft) / 60;
                if (timeInMinutes > 0) {
                    const currentWPM = Math.round(correctTyped / 5 / timeInMinutes);
                    const currentAccuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 0;
                    
                    // Update live stats display
                    typingTitle.textContent = `WPM: ${currentWPM} | Accuracy: ${currentAccuracy}%`;
                }
            }

            // Enhanced end test function
            function endTest(reason = 'Completed!') {
                clearInterval(timerInterval);
                started = false;
                isPaused = false;

                const timeInMinutes = parseInt(timeSelect.value) / 60;
                const wpm = Math.round(correctTyped / 5 / timeInMinutes);
                const accuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 0;
                const netWPM = Math.max(0, wpm - (errors / timeInMinutes));

                // Enhanced results display
                wpmValue.textContent = wpm;
                accuracyValue.textContent = accuracy + '%';
                charactersValue.textContent = `${correctTyped}/${totalTyped}`;

                // Add new statistics
                const statsContainer = document.querySelector('.stats');
                statsContainer.innerHTML += `
                    <div class="stat-item">
                        <div class="stat-value">${netWPM}</div>
                        <div class="stat-label">Net WPM</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${maxStreak}</div>
                        <div class="stat-label">Max Streak</div>
                    </div>
                `;

                result.style.display = 'block';
                typingTitle.textContent = reason;
                startBtn.disabled = false;

                // Save high score
                saveHighScore(wpm, accuracy, netWPM);
            }

            // New function to toggle pause
            function togglePause() {
                isPaused = !isPaused;
                typingTitle.textContent = isPaused ? 'Paused' : 'Resumed';
                if (isPaused) {
                    typingInput.blur();
                    } else {
                    typingInput.focus();
                }
            }

            // New function to save high scores
            function saveHighScore(wpm, accuracy, netWPM) {
                const highScores = JSON.parse(localStorage.getItem('typeTestHighScores') || '[]');
                const newScore = {
                    date: new Date().toISOString(),
                    language: languageSelect.value,
                    difficulty: difficultySelect.value,
                    wpm,
                    accuracy,
                    netWPM
                };
                
                highScores.push(newScore);
                highScores.sort((a, b) => b.netWPM - a.netWPM);
                localStorage.setItem('typeTestHighScores', JSON.stringify(highScores.slice(0, 10)));
            }

            // Toggle theme
            function toggleTheme() {
                document.body.classList.toggle('light-theme');
                const icon = themeToggle.querySelector('i');

                if (document.body.classList.contains('light-theme')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            }

            // Reset the typing test
            function resetTest() {
                clearInterval(timerInterval);
                currentIndex = 0;
                errors = 0;
                started = false;
                totalTyped = 0;
                correctTyped = 0;
                streakCount = 0;
                maxStreak = 0;

                result.style.display = 'none';
                typingTitle.textContent = 'Start typing when ready...';
                startBtn.disabled = false;

                updateTimer(parseInt(timeSelect.value));
                initializeTest();
            }

            // Update timer display
            function updateTimer(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }

            // Initialize the app
            initializeTest();
        });
    </script>
</body>

</html>
